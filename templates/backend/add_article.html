{% extends 'backend/backend_base.html' %}

{% block content %}
    <div>
        <p>添加文章</p>
        <form action="/add_article/" method="post">
            {% csrf_token %}
            <div class="form-group">
                <label for="id_title">文章标题</label>
                <input type="text" name="title" id="id_title" class="form-control">
            </div>
            <p>
                内容（KindEditor编辑器，不支持拖放/粘贴上传图片）
            </p>
            <textarea name="text_content" id="editor_id" cols="30" rows="10"></textarea>
            <div class="container-fluid">
                <div class="row">

                    <div class="col-md-4">
                        <select name="bigclass" id="bigclass_id">
                            <option value="0">--大类--</option>
                            <option value="1">理工类</option>
                            <option value="2">医学类</option>
                            <option value="3">人文类</option>
                        </select>

                        <select name="college" id="college_id">
                            <option value="">--院系--</option>
                        </select>
                    </div>

                    <div class="col-md-4">
                        <select name="category" id="category_id">
                            <option value="">--请选择分类--</option>
                            {#{{ data }}#}
                            {% for datum in data %}
                                <option value="{{datum}}">{{ datum }}</option>
                            {% endfor %}

                        </select>
                    </div>

                    <div class="col-md-4">

                    </div>
                </div>

            </div>

            <p>
                <button class="btn btn-success">提交</button>
                {#直接写button会触发提交表单#}
                {#<input type="submit">也会触发#}
                {#但是 <input type="button">不会触发#}
                {#ajax和form表单的提交会冲突#}
            </p>
        </form>
    </div>

    <script charset="utf-8" src="/static/kindeditor/kindeditor-all.js"></script>
    <script>
        KindEditor.ready(function(K) {
            window.editor = K.create('#editor_id',{
                width: '100%',
                height:'400px',
                resizeType:0,
                {#items:[#}
                {#    'source', '|', 'undo', 'redo', '|', 'preview', 'print', 'template', 'code', 'cut', 'copy', 'paste',#}
                {#    'plainpaste', 'wordpaste', '|', 'justifyleft', 'justifycenter', 'justifyright',#}
                {#    #}
                {#]#}
                uploadJson: '/uploadimg/',
                fileManagerJson : '/uploadfile/',
                allowFileManager : true,
                extraFileUploadParams : {
                    csrfmiddlewaretoken:'{{csrf_token}}',
                }
            });
        });

        {#院系的下拉框#}
        $('#bigclass_id').change(function () {
            // 获取点击大类的value
            bigclass_val = $(this).val()
            $.get('/college'+bigclass_val,function (data) {
                // 获取返回的json数据
                res = data.data
                // 获取college下拉列表框
                college = $('#college_id')
                // 清空college下拉列表框
                college.empty().append('<option value="">--院系--</option>')

                $.each(res, function (index, item) {
                    id = item
                    console.log(item)
                    option_str = '<option value="' + id + '">' + item + '</option>'
                    // 向college下拉列表框中追加元素
                    college.append(option_str)

                })

            })

        })

    </script>

{% endblock %}
